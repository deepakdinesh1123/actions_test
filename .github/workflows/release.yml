name: Open Pull Request

on:
  pull_request:
    types: [closed]

jobs:
  open-pull-request:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Create pull request to main
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Get the merged branch name
          MERGED_BRANCH="${{ github.event.pull_request.head.ref }}"

          # Create PR from merged branch to main
          gh pr create \
            --title "Merge $MERGED_BRANCH to main" \
            --body "Auto-generated PR to merge $MERGED_BRANCH into main branch" \
            --head "$MERGED_BRANCH" \
            --base "main" \
            --assignee "${{ github.actor }}" || echo "PR already exists or failed to create"
